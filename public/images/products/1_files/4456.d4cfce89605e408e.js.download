"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4456],{31181:function(e,t,n){n.d(t,{z:function(){return f}});var l=n(27161),i=n(50361),a=n.n(i),o=n(99598),r=n(51965),u=n(67294),s=n(32751),d=n(66830),c=n(42209),v=n(14484);let p=(e,t)=>{let n="".concat(c.apiBaseUrl,"/api/v1/image/pinned/").concat(e);return(0,o.uz)(n,{},{headers:{"X-CSRF-Token":t}})},f=()=>{let{token:e}=(0,v.EC)(),t=(0,s.Z)(),n=(0,l.D)({mutationFn:t=>{let{id:n}=t;return p(n,e)},onSuccess:(e,n)=>{let{id:l}=n,i=t.mutate(d.O.Images(),e=>e.pinterest_filter&&1===(0,r.w2)(e.pinterest_filter),t=>{let n=t.results.findIndex(e=>e.id===l);if(t.results[n]){let l=a()(t),i=(0,r.w2)(l.results[n].pinterest_viewed_user_remaining,0),o=(0,r.w2)(l.results[n].pinterest_counts_required,0)-e.count,u=l.pinterest_totals.user_remaining;return l.results[n].pinterest_viewed_user_remaining=Math.max(0,o),l.results[n].pinterest_counts_required=Math.max(0,o),l.pinterest_totals.user_remaining=u-(i-Math.max(0,o)),0===o&&(l.results.splice(n,1),l.total-=1),l}return null});return i.commit(),{transaction:i}},onError:(e,t,n)=>{let{transaction:l}=n;l.rollback()}});return{set:(0,u.useCallback)(e=>n.mutate({id:e}),[n])}}},41383:function(e,t,n){n.d(t,{Ij:function(){return p},JP:function(){return f},RW:function(){return s},U9:function(){return c},Vc:function(){return v},tj:function(){return d}});var l=n(63619),i=n(49305),a=n(78853),o=n(65118),r=n(43859),u=n(68365);let s=6,d=(e,t,n)=>{var l;let i=e.display_image_width||e.width||1,a=e.display_image_height||e.height||1;return(null==e?void 0:null===(l=e.metadata)||void 0===l?void 0:l.isPrint)&&n<u.tu?2*s+a/i*(t-2*s):a/i*t},c=(e,t)=>{let[n,l]=(0,a.pF)(e.width,e.height,e.units);return t/(n/l)},v=(e,t,n)=>{let a=(e,t)=>{let n=new i.Z(e);return t&&n.pushFilter(t,"tags_or"),n.toString()},o=[];return t&&o.push({label:"Add-on",queries:{tags:"$addons",topic_group:"$addons"},pathQuery:a(l.X3)}),"layerphoto"===e?o.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:a(l.bj,"$jpegtiff")},{label:"PSD",queries:{tags_or:"$psd"},pathQuery:a(l.bj,"$psd")}):"vector"===e?o.push({label:"Vector",queries:{tags_or:"$vector"},pathQuery:a(l.bj,"$vector")}):"png"===e?o.push({label:"PNG",queries:{tags_or:"$png"},pathQuery:a(l.bj,"$png")}):"docx"===e?o.push({label:"Word",queries:{tags_or:"$docxpdf"},pathQuery:a(l.bj,"$docxpdf")}):"pdf"===e?o.push({label:"PDF",queries:{tags_or:"$pdf"},pathQuery:a(l.bj,"$pdf")}):n?o.push({label:"Font",queries:{tags:"$fonts",topic_group:"$fonts"},pathQuery:a(l.lH)}):o.push({label:"Photo",queries:{tags_or:"$jpegtiff"},pathQuery:a(l.bj,"$jpegtiff")}),o},p=e=>[(null==e?void 0:e.display_image_width)||(null==e?void 0:e.width)||1,(null==e?void 0:e.display_image_height)||(null==e?void 0:e.height)||1],f=async(e,t)=>{try{let n=await (0,r.ny)(e.uid,e.id,t);(null==n?void 0:n.url)&&(0,o.O)(n.url)}catch(e){console.log(e)}}},49453:function(e,t,n){var l=n(64132),i=n(50361),a=n.n(i),o=n(67294),r=n(16550),u=n(33818),s=n(66830),d=n(31181),c=n(32360),v=n(14484),p=n(64739),f=n(20419),g=n(98756),h=n(96165),b=n(10974),m=n(64964),w=n(68365),_=n(228),y=n(8811),k=n(23555),C=n(62359);let D={};t.Z=(e,t,n,i)=>{var T,$;let{data:x}=(0,v.aF)(),F=(0,v.EC)(),j=F.isReady&&F.isLoggedIn,{data:q}=(0,p.Z0)(j),{activeTeam:P}=(0,y.Z)(),{showUpgradeModal:S,showFreeSignupThrottledModal:R}=(0,k.Z)(),{setOpen:Z}=(0,b.ZP)(),{setOpen:Q}=(0,g.Z)(),E=(0,r.k6)(),L=(0,c.R)(),{showRawpixelTeam:B}=(0,h.ZP)(),I=(0,C.Z)(w._y),{openSignupModal:M,closeModal:O}=(0,f.ZP)(),[N,z]=(0,o.useState)(!1),[A,H]=(0,o.useState)(),[U,G]=(0,o.useState)(!1),[V,W]=(0,o.useState)(),X=!!B&&!!(null==x?void 0:null===(T=x.access)||void 0===T?void 0:T.show_rawpixel_team),J=o.useMemo(()=>{var t;return null===(t=e||[])||void 0===t?void 0:t.filter(e=>null==e?void 0:e.id).map(e=>null==e?void 0:e.id)},[e]),{data:K=D}=(0,u.rc)("image",J,J.length>0&&!i),{set:Y}=(0,u.sj)(),{set:ee}=(0,d.z)(),et=(0,l.NL)(),en=o.useCallback(e=>{if(!I&&!X){null==e||e.preventDefault(),z(!0);return}},[X,I]),el=o.useCallback(e=>{if(!I&&!X){e.preventDefault(),z(!0);return}},[I,X]),ei=o.useCallback((e,t,l)=>{if(n){n(e,t,l);return}if("image"===e.type){et.setQueryData(s.O.ImageLocal({id:e.id}),{image:a()(e),placeHolderSrc:t});return}"template"===e.type&&en(l),"design"===e.type&&el(l)},[n,et,el,en]),ea=o.useCallback((e,t,n)=>{if(x&&x.uid>0)Y(x.uid,"image",t,n);else{var l,i;(null==x?void 0:null===(i=x.website_status)||void 0===i?void 0:null===(l=i.throttle_free_signup)||void 0===l?void 0:l.enabled)?R(!0):M()}},[x,Y,M,R]),eo=o.useCallback(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=arguments.length>3?arguments[3]:void 0;if((null==x?void 0:x.uid)>0){e.stopPropagation(),e.preventDefault();let i=o.createRef();i.current=e.currentTarget,Z(i,t,n,l)}else{var i,a;(null==x?void 0:null===(a=x.website_status)||void 0===a?void 0:null===(i=a.throttle_free_signup)||void 0===i?void 0:i.enabled)?R(!0):M()}},[Z,null==x?void 0:x.uid,M,R,null==x?void 0:x.website_status]),er=o.useCallback((e,t,n,l)=>{e.stopPropagation(),e.preventDefault();let i=o.createRef();i.current=e.currentTarget,Q(i,t,n,l)},[Q]),eu=o.useCallback((e,n,l,i)=>{if(x&&x.uid>0){if(e.stopPropagation(),e.preventDefault(),"project"!==l)return;let{id:a}=t;L(a,[{type:m.Uu[n.type],id:n.id}],"delete",i)}},[x,L,t]),es=o.useCallback((e,t)=>{x&&x.uid>0&&ee(t)},[x,ee]),ed=o.useCallback(e=>{if(!I&&!X){null==e||e.preventDefault(),z(!0);return}},[X,I]),ec=o.useCallback((t,n)=>{let l=e.find(e=>e.id===n);if(l){if(x&&x.uid>0){var i,a,o,r,u,s,d,c;!x.is_free||x.free_premium_active||(null==l?void 0:null===(i=l.metadata)||void 0===i?void 0:i.isFreeLicense)||(null==l?void 0:null===(a=l.metadata)||void 0===a?void 0:a.isCC0License)?X||!x.is_free||x.free_premium_active||null==l||null===(o=l.metadata)||void 0===o||!o.isFreeLicense||(null==l?void 0:null===(r=l.metadata)||void 0===r?void 0:r.isCC0License)||(null==q?void 0:null===(u=q.limits)||void 0===u?void 0:u.unlimited)||!((null==q?void 0:null===(s=q.limits)||void 0===s?void 0:s.remaining)<=0)||(null==q?void 0:null===(c=q.limits)||void 0===c?void 0:null===(d=c.ids)||void 0===d?void 0:d.includes(null==l?void 0:l.id))?H(l):S({feature:_.HN,upgradeBoxType:"black"}):S({feature:_.D8,upgradeBoxType:"black",image:l})}else E.push("/user/register?destination=/image/".concat(n))}},[e,x,E,null==q?void 0:q.limits,X,S]),ev=o.useCallback((e,t)=>{G(!0),W(t)},[]),ep=o.useCallback(()=>{O(),z(!1),H(void 0)},[O]),ef=!!(null==x?void 0:x.uid)&&!!t&&((null==x?void 0:null===($=x.access)||void 0===$?void 0:$.edit_any_board)||"user"===t.owner.type&&t.owner.id===(null==x?void 0:x.uid)||!!P&&"team"===t.owner.type&&t.owner.id===P.id),eg=o.useCallback(()=>{H(void 0),G(!1),W(null)},[]);return o.useMemo(()=>({onImageClick:ei,canDeleteFromProject:ef,onSaveClick:eo,onDotsMenuClick:er,onDeleteFromProjectClick:eu,onFavoriteClick:ea,onPinterestClick:es,onAdjustmentClick:ed,favorites:K,closeModal:ep,onDownloadClick:ec,imageToDownload:A,closeDrawer:eg,onShareClick:ev,shareImage:V,shareDrawer:U,showEditRestrictedModal:N}),[ei,ef,eo,er,eu,ea,es,ed,K,ep,ec,A,eg,ev,V,U,N])}},65118:function(e,t,n){n.d(t,{O:function(){return l},u:function(){return o}});let l=e=>{window.location.assign(e)},i=null,a=()=>{if("boolean"==typeof i)return i;if("undefined"==typeof ReadableStream||"undefined"==typeof Request||"undefined"==typeof Blob||"function"!=typeof new Blob().arrayBuffer)return i=!1;try{let e=!1,t=new Request("",{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");i=e&&!t}catch(e){i=!1}return i};async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];{if(!t||(null==t?void 0:t.length)===0||!a()){window.location.assign(e);return}let r=[e,...t],u=0,s=Date.now();for(;r.length>0&&Date.now()-s<3e4;){let a=Date.now(),d=r.shift(),c=null,v=null,p=null,f=new AbortController;f.signal.onabort=e=>{var t;return null==e?void 0:null===(t=e.preventDefault)||void 0===t?void 0:t.call(e)};let g=setTimeout(()=>{f.signal.aborted||f.abort("Timeout. Download url is not reachable: "+d)},6500);try{(null==(c=await fetch(d,{method:"GET",signal:f.signal,credentials:"omit"}))?void 0:c.ok)||(p=!1,console.warn({message:"File connection failed ".concat(e,": ").concat(c.status," ").concat(c.statusText)}))}catch(t){f.signal.aborted?console.debug("Aborted. Timeout."):console.warn({message:"File connection failed ".concat(e,": ").concat(t.message),ok:null==c?void 0:c.ok,status:null==c?void 0:c.status}),p=!1}if(!1===p){try{clearTimeout(g),f.signal.aborted||f.abort("Done.")}catch(e){}u+=1;continue}if(!f.signal.aborted&&(null==c?void 0:c.ok)&&(null==c?void 0:c.status)===200){if(u>0||Date.now()-a>5e3)p=!0,console.debug("File connection ok. ".concat(0===u?"Triggered the original download url request, no test connection too slow. ".concat(Date.now()-a," ms."):"Triggering a mirror download url request. ".concat(Date.now()-a," ms, ").concat(u,"/").concat(t.length," mirror attempts.")));else{var n,l,i,o;let t=!c.body.locked&&(null==c?void 0:null===(l=c.body)||void 0===l?void 0:null===(n=l.getReader)||void 0===n?void 0:n.call(l));try{v=await t.read()}catch(n){console.warn({message:"File read failed ".concat(e,": ").concat(c.status," ").concat(c.statusText),error:n.message}),null==t||null===(o=t.cancel)||void 0===o||o.call(t).catch()}(null==v?void 0:null===(i=v.value)||void 0===i?void 0:i.byteLength)>1e3&&(p=!0,console.debug("File readable. Triggered the original download url request. ".concat(Date.now()-a," ms.")))}try{clearTimeout(g),f.signal.aborted||f.abort("Done.")}catch(e){}if(!0===p){console.debug("Triggered after ".concat(Date.now()-s," ms.")),window.location.assign(e);return}}u+=1}window.location.assign(e)}}},78853:function(e,t,n){n.d(t,{Mm:function(){return i},b7:function(){return l},jB:function(){return a},pF:function(){return o}});let l=96,i=300,a=150,o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"px",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"px",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l,o="number"==typeof e?e:parseFloat(e),r="number"==typeof t?t:parseFloat(t);if(n===i)return[o,r];let u=a/2.54,s=null;switch(n){case"in":s=[o*a,r*a];break;case"cm":s=[o*u,r*u];break;case"px":s=[o,r];break;default:throw Error("Invalid unit value ".concat(n))}let[d,c]=s;switch(i){case"in":return[d/a,c/a];case"cm":return[d/u,c/u];case"px":return s;default:throw Error("Invalid unit value ".concat(i))}}}}]);